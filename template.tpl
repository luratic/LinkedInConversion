___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "displayName": "LinkedIn Conversion",
  "description": "This is an unofficial Google Tag Manager template for LinkedIn conversion tracking.",
  "categories": ["CONVERSIONS", "MARKETING"],
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAACuFBMVEUAAAAAAP8Af38AVaoAf78AZswAf6oAbbYAf78AcakAf7IAc7kAaqoAdbAAd7sAb68AeLQAcbgAeK4AcrIAebYAc60AbrEAdLQAcLcAdbAAcbMAdrYAcq8Ad7IAc7QAd68Ac7EAcLQAdLYAcbEAdbMAdbAAcrIAdrQAc7AAdrEAc7MAcbUAdLEAcbMAdLQAcrAAdbIAc7QAdbUAc7IAdrMAc7QAcbEAdLIAcrQAdLEAcrIAdbMAc7QDc7MDdbQDc7EDcrIDdLQDcrEDdLIDcrMDdLQDc7QDdbEDcrMDdLEDcrIDdLMDc7QDdLIDc7MDdbQCc7ECc7MCcrECdLICcrMCdLQCc7ICdLMCc7MCdLECc7ICdbMCc7ECcrICdLMCc7QCdLICc7ICc7ICdLICc7MCdLQCc7ICcrMCdLMCc7ICdLICc7MCdLICc7ICdLMCdLICc7MCcrMCdLICc7ICdLMCc7ICdLIBc7MBdLMBdLMBc7MBdLIBdLIBdLIBc7IBdLMBc7MBdLIBc7MBdLMBcrIBdLIBdLMBc7IBdLIBc7MBdLMBc7IBdLMBdLIBcrEBdLMBdLMBc7IBdLMBc7MBdLIBc7EBdLMBc7IBdLEBcrMBdLIBc7MBdLMBc7IBc7MBcrEBdLIBdLMBc7MBdLIBc7EBdLMBc7IBdLEBcrMBcrIBc7IBdLECc7MCdLICcrECdLMCdLICdLMCdLICc7ECdLMCc7ICdLECcrMCdLMCcrECdLECcrMCdLICdLECc7MCdLMCc7ECdLMCcrMCdLECcrECdLMCcrICdLECc7MCdLECcrMCdLMCcrECdLECcrMCdLICcrECdLMCdLMCc7ECdLMCcrMCdLECcrECdLMCcrICdLECcrMCdLMCcrMCdLMCcrECdLECcrMCdLICcrECdLMCcrMCdLECdLO0CczIAAAA53RSTlMAAQIDBAUGBwgJCgsMDQ8QERITFBUWFxgZGhscHR4fICEiIyQlJygpKissLS4vMDEyMzQ1Njc4OTo7PD0+QEFCQ0RFRkdIS0xOT1BRUlNUVVZYWVpbXF1eX2BhYmNkZWZnaGprbG1ub3BxcnN0dXZ4eXp7fH1+f4CBg4SFhoiJiouMjY6PkJGSk5SVlpeZmpucnZ6foKGi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\u003d",
    "displayName": "Custom template created by Luratic",
    "id": "brand_dummy"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "help": "Insert here \u003cstrong\u003epartnerId(pid)\u003c/strong\u003e parameter.\n https://px.ads.linkedin.com/collect/?pid\u003d\u003cstrong\u003e1234\u003c/strong\u003e\u0026conversionId\u003d4312\u0026fmt\u003dgif",
    "alwaysInSummary": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "NUMBER"
      }
    ],
    "displayName": "Account Id(pid):",
    "simpleValueType": true,
    "name": "partnerId",
    "type": "TEXT"
  },
  {
    "alwaysInSummary": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "displayName": "Conversion Id(conversionId):",
    "simpleValueType": true,
    "name": "conversionId",
    "type": "TEXT",
    "help": "Insert here \u003cstrong\u003econversionId(pid)\u003c/strong\u003e parameter.  https://px.ads.linkedin.com/collect/?pid\u003d1234\u0026conversionId\u003d\u003cstrong\u003e4312\u003c/strong\u003e\u0026fmt\u003dgif"
  },
  {
    "type": "LABEL",
    "name": "info",
    "displayName": "\u003ca href\u003d\"https://www.luratic.com/posts/templates/tags/linkedin-conversion/\"\u003eMore info\u003c/a\u003e"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Introduzca aquí su código de plantilla.
//var log = require('logToConsole');
const sendPixel = require('sendPixel');
const getTimestamp = require('getTimestamp');
const encodeUriComponent = require('encodeUriComponent');


const pid = encodeUriComponent(data.partnerId);
const conversionId =  encodeUriComponent(data.conversionId);

var trackingUrl = 'https://px.ads.linkedin.com/collect/?pid=' + pid + '&conversionId=' + conversionId + '&fmt=gif&cb=' + getTimestamp(); 

sendPixel(trackingUrl,data.gtmOnSuccess,data.gtmOnFailure);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://px.ads.linkedin.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: gtmOnSuccess is invoked on sendPixel success
  code: |-
    // test that gtmOnSuccess() is called when sendPixel succeeds
    mock('sendPixel', (url, onSuccess, onFailure) => {
      onSuccess();
    });

    // Call runCode to run the template's code.
    runCode();

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: gtmOnFailure is invoked when sendPixel fails
  code: |-
    // test gtmOnFailure() is called when sendPixel fails
    mock('sendPixel', (url, onSuccess, onFailure) => {
      onFailure();
    });

    // Call runCode to run the template's code.
    runCode();

    // Verify onFailure was called
    assertApi('gtmOnFailure').wasCalled();


___NOTES___

Developed with ❤ by: Alfonso, Txema and Brais.
Web: www.luratic.com
Linkedin: 
https://www.linkedin.com/in/braiscalvo/
https://www.linkedin.com/in/alfonsorc/
https://www.linkedin.com/in/txema-s%C3%A1nchez-a48482ba/


